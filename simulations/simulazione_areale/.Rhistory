boundary = read.table("is_boundary.txt", header =F)
dim(boundary)
range(boundary)
range(elements)
library(fdaPDE)
mesh = create.mesh.3D(nodes = nodes , tetrahedrons = elements)
plot(mesh)
points3d(mesh$nodes[boundary!=1,1],
mesh$nodes[boundary!=1,2],
mesh$nodes[boundary!=1,3], col ="black")
points3d(mesh$nodes[boundary==1,1],
mesh$nodes[boundary==1,2],
mesh$nodes[boundary==1,3], col ="red", pch=16)
faces <- as.vector(t(mesh$faces[mesh$facesmarkers,]))
open3d()
axes3d()
pop3d("lights")
light3d(specular="black")
triangles3d(nodes[faces,1],nodes[faces,2],nodes[faces,3], col="white", alpha=0.2)
points3d(nodes[boundary!=1,1], nodes[boundary!=1,2], nodes[boundary!=1,3], col="black")
voxels_coords = affine %*% rbind(t(voxel_indixes), rep(1,times=nrow(voxel_indixes)))
nifti = readNifti("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/0/suvr_mni_icbm152_nlin_asym_09c_linear.12.dof.normalized.nii.gz")
library(RNifti)
nifti = readNifti("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/0/suvr_mni_icbm152_nlin_asym_09c_linear.12.dof.normalized.nii.gz")
affine = xform(nifti)
voxel_indixes = as.matrix(expand.grid(0:(dim(nifti)[1]-1),
0:(dim(nifti)[2]-1),
0:(dim(nifti)[3]-1)))
voxels_coords = affine %*% rbind(t(voxel_indixes), rep(1,times=nrow(voxel_indixes)))
voxels_coords = t(voxels_coords)[,-4]
plot(mesh)
points3d(voxels_coords[,1],
voxels_coords[,2],
voxels_coords[,3], col="red3")
inside = fdaPDE:::CPP_search_points(mesh, voxels_coords)
range(inside)
256^3
dim(voxel_indixes)
length(inside)
idxs = which(inside != 0)
plot(mesh)
open3d()
axes3d()
pop3d("lights")
light3d(specular="black")
triangles3d(nodes[faces,1],nodes[faces,2],nodes[faces,3], col="white", alpha=0.2)
points3d(voxels_coords[idxs,1],
voxels_coords[idxs,2],
voxels_coords[idxs,3], col="red3")
write.table("vox.indices.16.txt")
write.table(idxs, "vox.indices.16.txt")
obs = nifti[inside]
dim(obs)
length(obs)
locs = voxels_coords[inside,]
dim(locs)
obs = nifti[idxs]
locs = voxels_coords[idxs,]
dim(locs)
idxs = read.table("vox.indices.16.txt")
obs = nifti[inside]
locs = voxels_coords[inside,]
open3d()
axes3d()
pop3d("lights")
light3d(specular="black")
triangles3d(nodes[faces,1],nodes[faces,2],nodes[faces,3], col="white", alpha=0.2)
points3d(voxels_coords[idxs,1],
voxels_coords[idxs,2],
voxels_coords[idxs,3], col="red3")
idxs
idxs = as.matrix(read.table("vox.indices.16.txt"))
obs = nifti[inside]
locs = voxels_coords[inside,]
open3d()
axes3d()
pop3d("lights")
light3d(specular="black")
triangles3d(nodes[faces,1],nodes[faces,2],nodes[faces,3], col="white", alpha=0.2)
points3d(voxels_coords[idxs,1],
voxels_coords[idxs,2],
voxels_coords[idxs,3], col="red3")
length(idxs)
obs = matrix(0,nrow=length(idxs),ncol=1)
locs = voxels_coords[idxs,]
writeMM(Matrix(obs, sparse=T), paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/mesh/locs.mtx"))
for( t in 0:3){
nifti = readNifti(paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/",t,"/suvr_mni_icbm152_nlin_asym_09c_linear.12.dof.normalized.nii.gz"))
obs[,t+1] = nifti[idxs]
print(range(obs[,t+1]))
}
t
obs = matrix(0,nrow=length(idxs),ncol=4)
for( t in 0:3){
nifti = readNifti(paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/",t,"/suvr_mni_icbm152_nlin_asym_09c_linear.12.dof.normalized.nii.gz"))
obs[,t+1] = nifti[idxs]
print(range(obs[,t+1]))
}
writeMM(Matrix(obs, sparse = T), "/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/mesh/obs.mtx")
mycolors<- function(x) {
colors<-viridis( x + 1 )
colors[1:x]
}
n_breaks = 20
mycols <- mycolors(n_breaks + 2)
library(viridis)
mycolors<- function(x) {
colors<-viridis( x + 1 )
colors[1:x]
}
n_breaks = 20
mycols <- mycolors(n_breaks + 2)
col_idx <- cut(obs, breaks = breaks, include.lowest = TRUE, labels = FALSE)
#vals   <- seq(0, 1, length.out = length(mycols))
n_col = 100
breaks <- seq(lims[1], lims[2], length.out = n_col + 1)
#vals   <- seq(0, 1, length.out = length(mycols))
n_col = 100
breaks <- seq(0, 1, length.out = n_col + 1)
col_idx <- cut(obs, breaks = breaks, include.lowest = TRUE, labels = FALSE)
col <- mycol[col_idx]
col_idx
col <- viridis(ncol)
ncol
viridis(ncol)
ncol
col <- viridis(n_col)
open3d()
axes3d()
pop3d("lights")
light3d(specular="black")
triangles3d(nodes[faces,1],nodes[faces,2],nodes[faces,3], col="white", alpha=0.2)
points3d(voxels_coords[idxs,1],
voxels_coords[idxs,2],
voxels_coords[idxs,3], col=col)
writeMM(Matrix(locs, sparse=T), paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/mesh/locs.mtx"))
head(locs)
hist(obs)
install.packages("oro.dicom")
setwd("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI-raw/035_S_4114/AV1451_Coreg,_Avg,_Std_Img_and_Vox_Siz,_Uniform_6mm_Res/")
library(oro.dicom)
DICOM = oro.dicom::readDICOM("2016-08-12_15_18_02.0/")
DICOM = oro.dicom::readDICOM("2016-08-12_15_18_02.0/I1597353/")
DICOM$img
DICOM$hdr
DICOM$hdr$`2016-08-12_15_18_02.0/I1597353//ADNI_035_S_4114_PT_AV1451_Coreg,_Avg,_Std_Img_and_Vox_Siz,_Uniform_6mm_Res_Br_20220629120554858_75_S492394_I1597353.dcm`
dim(nifti)
sum(nifti) / length(idxs)
pet = readNifti("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/0/PET_to_mni_icbm152_nlin_asym_09c_linear.12.dof.nii.gz")
hist(pet)
hist(pet[inside])
hist(pet)
hist(pet[idxs])
for(k in 0:3){
data_0 = readMM(paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/",k , "/suvr_mni_icbm152_nlin_asym_09c_linear.12.dof.normalized.mtx"))
data_0_simNIBS = readMM(paste0("/media/aldoclemente/EXTERNAL_USB/data/adni3-ad-mci/ADNI/035_S_4114/PET/", k ,"/suvr.mni_icbm152_nlin_asym_09c.linear.12.dof.normalized.mtx"))
print( range(data_0) )
print( range(data_0_simNIBS) )
}
hist(data_0)
class(data_0)
hist(as.matrix(data_0))
setwd("~/Desktop/LN-simulations")
#
library(fdaPDE)
sessionInfo()
library(spatstat)
# DE_PDE$FEMbasis$mesh[[11]] = 1
# DE_PDE$FEMbasis$mesh[[6]] = 1
# DE_PDE$FEMbasis$mesh[[7]] = 1
# DE_PDE$FEMbasis$mesh[[8]] = 1
# DE_PDE$FEMbasis$mesh[[9]] = 1
# DE_PDE$FEMbasis$mesh[[10]] = 1
# for(i in 6:11){
#   storage.mode( DE_PDE$FEMbasis$mesh[[i]] ) <- "integer"
# }
data("dendrite")
inside = fdaPDE:::CPP_search_points(DE_PDE$FEMbasis$mesh,
locations = c(dendrite$data$x, dendrite$data$y))
load("density-estimation/dendrite_case_study/data.RData")
inside = fdaPDE:::CPP_search_points(DE_PDE$FEMbasis$mesh,
locations = c(dendrite$data$x, dendrite$data$y))
inside = fdaPDE:::CPP_search_points(DE_PDE$FEMbasis$mesh,
locations = cbind(dendrite$data$x, dendrite$data$y))
inside
Frame(dendrite)
myF = function(x,y){
points = cbind(x,y)
print(points)
inside = fdaPDE:::CPP_search_points(DE_PDE$meanField[[1]]$FEMbasis$mesh,
points)
print( sum(inside!=0) )
plot(DE_PDE$meanField[[1]]$FEMbasis$mesh) +
geom_point(data=data.frame(x=x, y=y),
aes(x=x, y=y), col="red3", size=3)
vals=matrix(0, nrow = points, ncol=1)
vals[inside==0] = NA
vals[inside] = fdaPDE::eval.FEM(FEM = DE_PDE$meanField[[1]],
locations = points[inside!=0,])
return(vals)
}
x = seq(0,1, by=0.001)
y= x
tmp = myF(X$xcol,X$yrange)
Z <- as.im(myF, Frame(dendrite))
Frame(dendrite)
myF = function(x,y){
points = cbind(x,y)
print(points)
inside = fdaPDE:::CPP_search_points(DE_PDE$meanField[[1]]$FEMbasis$mesh,
points)
print( sum(inside!=0) )
plot(DE_PDE$meanField[[1]]$FEMbasis$mesh) +
geom_point(data=data.frame(x=x, y=y),
aes(x=x, y=y), col="red3", size=3)
vals=matrix(0, nrow = points, ncol=1)
vals[inside==0] = NA
vals[inside] = fdaPDE::eval.FEM(FEM = DE_PDE$meanField[[1]],
locations = points[inside!=0,])
return(vals)
}
Z <- as.im(myF, Frame(dendrite))
library(ggplot2)
myF = function(x,y){
points = cbind(x,y)
print(points)
inside = fdaPDE:::CPP_search_points(DE_PDE$meanField[[1]]$FEMbasis$mesh,
points)
print( sum(inside!=0) )
plot(DE_PDE$meanField[[1]]$FEMbasis$mesh) +
geom_point(data=data.frame(x=x, y=y),
aes(x=x, y=y), col="red3", size=3)
vals=matrix(0, nrow = points, ncol=1)
vals[inside==0] = NA
vals[inside] = fdaPDE::eval.FEM(FEM = DE_PDE$meanField[[1]],
locations = points[inside!=0,])
return(vals)
}
x = seq(0,1, by=0.001)
y= x
tmp = myF(X$xcol,X$yrange)
Z <- as.im(myF, Frame(dendrite))
X <- linim(dendrite, Z,restrict = F)
Z <- as.im(myF, Frame(dendrite))
myF = function(x,y){
points = cbind(x,y)
write.table(points, "points.txt")
inside = fdaPDE:::CPP_search_points(DE_PDE$meanField[[1]]$FEMbasis$mesh,
points)
print( sum(inside!=0) )
plot(DE_PDE$meanField[[1]]$FEMbasis$mesh) +
geom_point(data=data.frame(x=x, y=y),
aes(x=x, y=y), col="red3", size=3)
vals=matrix(0, nrow = points, ncol=1)
vals[inside==0] = NA
vals[inside] = fdaPDE::eval.FEM(FEM = DE_PDE$meanField[[1]],
locations = points[inside!=0,])
return(vals)
}
x = seq(0,1, by=0.001)
y= x
tmp = myF(X$xcol,X$yrange)
Z <- as.im(myF, Frame(dendrite))
plot(DE_PDE$meanField[[1]]$FEMbasis$mesh)
points = read.table("points.txt")
head(points)
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=3)
#library(splines)
# loading packages and auxiliary functions
# source("utils//packages.R")
source("utils/utils.R")
source("utils/plot.R")
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=3)
inside = fdaPDE:::CPP_search_points(DE_PDE$FEMbasis$mesh, points)
inside = fdaPDE:::CPP_search_points(DE_PDE$FEMbasis$mesh, as.matrix(points))
sum(inside != 0)
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=3) +
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray")
points = fdaPDE::projection.points.1.5D(DE_PDE$FEMbasis$mesh, points)
head(points)
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=3)
points = read.table("points.txt")
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=0.5)
plot( DE_PDE$FEMbasis$mesh,linewidth=2, col="gray") +
geom_point(data=data.frame(x=points[,1], y=points[,2]),
aes(x=x, y=y), col="red3", size=0.25)
tmp = readMM("~/Desktop/nonlinear-strpde/simulations/app-pointwise-2/mesh/ic_estimate.mtx")
range(tmp)
Z <- as.im(function(x,y) {x-y}, Frame(simplenet))
X <- linim(simplenet, Z)
plot(X)
myF = linfun(function(x,y) {x-y}, simplenet)
myF = linfun(function(x,y, seg,tp) {x-y}, simplenet)
??linim
??spatstat::linim
library(spatstat)
??spatstat::linim
??spatstat.linnet::linim
myF
X <- as.linim(myF)
plot(X)
plot(X, type="width")
??spatstat.linnet::plot.lppm
plot(X, style="width")
plot(X, style="width", legend=F)
plot(X, style="width", legend=F, main="")
myF = linfun(function(x,y, seg,tp){
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
}, dendrite)
myF = linfun(function(x,y, seg,tp){
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
X
myF = linfun(function(x,y, seg,tp){
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
range(X$v,na.rm = T)
myF = linfun(function(x,y, seg,tp){
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
X
range(X$v,na.rm = T)
X$v
X$dim
X$xrange
X$yrange
myF = linfun(function(x,y, seg,tp){
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
dim( X$v )
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
#res = x - y
return(res)
}, dendrite$domain)
X <- as.linim(myF)
X$v
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, simplenet)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
write.table(cbind(x,y), "point2.txt")
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
write.table(cbind(x,y), "point2.txt")
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, simplenet)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
points = read.table("point2.txt")
plot(simplenet)
points(points)
myF = linfun(function(x,y, seg,tp){
points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, cbind(x,y))
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
range(X$v,na.rm = T)
myF = linfun(function(x,y, seg,tp){
points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, points)
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
range(X$v,na.rm = T)
myF = linfun(function(x,y, seg,tp){
points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, points)
print(points)
res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
write.table(cbind(x,y), "point2.txt")
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, simplenet)
X <- as.linim(myF)
dendrite$domain
myF = linfun(function(x,y, seg,tp){
points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, points)
print(points)
res = eval.FEM(DE_PDE$meanField[[1]], points)
return(res)
}, dendrite$domain)
X <- as.linim(myF)
myF = linfun(function(x,y, seg,tp){
points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, cbind(x,y))
print(points)
res = eval.FEM(DE_PDE$meanField[[1]], points)
return(res)
}, dendrite$domain)
X <- as.linim(myF)
X$v
myF = linfun(function(x,y, seg,tp){
#points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, cbind(x,y))
print(points)
res = fdaPDE::eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
myF = linfun(function(x,y, seg,tp){
#points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, cbind(x,y))
print(points)
res = fdaPDE::eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
range(X$v,na.rm = T)
X
myF = linfun(function(x,y, seg,tp){
#points = projection.points.1.5D(DE_PDE$FEMbasis$mesh, cbind(x,y))
print(cbind(x,y))
res = fdaPDE::eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
return(res)
}, dendrite$domain)
X <- as.linim(myF)
points = read.table("point2.txt")
head(points)
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
write.table(cbind(x,y), "point2.txt")
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, dendrite$domain)
points = read.table("point2.txt")
head(points)
myF = linfun(function(x,y, seg,tp){
print(cbind(x,y))
write.table(cbind(x,y), "point2.txt")
#res = eval.FEM(DE_PDE$meanField[[1]], cbind(x,y))
res = x - y
return(res)
}, dendrite$domain)
X <- as.linim(myF)
plot(X, style="width", legend=F, main="")
points = read.table("point2.txt")
head(points)
dim(points)
128*128
X$dim
dim( X$v )
plot(points)
X$xcol
grid = expand.grid(X$xcol, X$yrow)
dim(grid)
X$xcol
grid = expand.grid(X$xcol, X$yrow)
res =matrix(nrow = 128, ncol=128)
for(i in 1:128){
for(j in 1:128){
res[i,j] = eval.FEM(DE_PDE$meanField[[1]], locations = cbind(X$xcol[i], X$yrow[j]))
}
}
range(res)
plot(grid)
range(grid[,1])
dendrite
spatstat.linnet::plot.lppm
??spatstat.linnet::plot.lppm
??lppm
X <- runiflpp(10, simplenet)
fit <- lppm(X ~x)
plot(fit)
plot(fit, style="width")
setwd("~/Desktop/nonlinear-strpde/")
setwd("simulations/simulazione_areale/")
setwd("~/Desktop/nonlinear-strpde/simulations/simulazione_areale")
